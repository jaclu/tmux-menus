# Tmux-Menus

<img width="250" alt="main"
src="https://github.com/user-attachments/assets/ee328ee0-1b02-42dc-84db-a3f7f3004d28" />
<img width="250" alt="main-styled"
src="https://github.com/user-attachments/assets/8361f74a-3eee-4053-9f87-f044a8304822" />

## Summary

Popup menus to help with managing the tmux environment. If so desired,
[styling](docs/Styling.md) can be used, as can be seen above to the right.

Once installed, hit the trigger to get the main menu to pop up.
The default is `<prefix> \` see Configuration below for how to change it.

Not too hard to adapt to fit your needs. Items that some
might find slightly redundant are included, easier to remove excess for more
experienced users, then add more for newbies.

## Recent Changes

- Added alternate menus support - see [Alternate menus](#alternate-menus) below
- Fixed bug in Missing Keys, prevented some keys from being used
- Fixed bug in Extras - hiding external tools
- Missing Keys - Currencies; Added bitcoin glyph
- Missing Keys - Diacritics; Added entry of common diacritics

## Purpose

tmux provides a few basic popup menus by default, but they're quite limited and
difficult to extend due to their complex, mouse-based one-liner implementations.
A more integrated, user-friendly approach with better navigation and flexibility
seemed like the right solution.

Not solely meant for beginners, I use it myself all the time:

- Using `Display menu commands` as a reminder of shortcuts for common tasks
- When connecting using terminals without much support for Meta or even lacking arrows,
  this gives access to all the actions that aren't available with the
  regular shortcuts. For instance, when running the built in Terminal on
  MacOS the console keyboard is pretty limited.
- Tasks that would need external scripts to avoid hard-to-read
  complex bind one-liners, such as killing the current session without getting
  disconnected.
- When direct typing would be much longer.
  Example: Kill the server directly with 12 keys:
  `<prefix> : kill-ser <tab> <enter>`
  with the menus 5 keys: `<prefix> \ A x y`

## Screenshots

The white one is generated with whiptail, as can be seen whiptail menus use a lot
more screen real estate. However if they don't fit they are scrollable unlike
the tmux menus, if they don't fit, they are just not displayed.
The rest are generated by the tmux built-in `display-menu`

<img width="265" alt="Handling Pane"
src="https://github.com/user-attachments/assets/e0ad06c4-16ed-4e82-96bc-fd7e401c18a5" />
<img width="297" alt="Handling Window"
src="https://github.com/user-attachments/assets/d97d4e13-67a0-4207-9bc0-b875bc808661" />
<img width="337" alt="Help summary"
src="https://github.com/user-attachments/assets/fadeb163-5513-4e60-b847-8fb74d93fc59" />
<img width="264" alt="Missing Keys"
src="https://github.com/user-attachments/assets/6a537dae-3530-4e5e-8402-d3c272faf6c8" />
<img width="270" alt="Missing Keys-whiptail"
src="https://github.com/user-attachments/assets/4da2a426-2299-4234-8d84-89ae52e9761a" />

## Dependencies & Compatibility

| Version    | Notice                                                                                                                             |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 3.4        | Styling can be used.                                                                                                               |
| 3.2        | Menu location fully available.                                                                                                     |
| 3.0 - 3.1c | Menu centering is not supported, it's displayed top left if C is selected.                                                         |
| < 3.0      | Needs `whiptail` or `dialog` (see below). Menu location and styling settings are ignored.                                          |
| < 1.8      | tpm is not available, so the plugin needs to be initialized by running [path to tmux-menus]/menus.tmux directly from the conf file |
| 1.5        | Minimal tmux version required                                                                                                      |

The above table covers compatibility for the general tool. Some menu items
has a min tmux version set, if the running tmux doesn't match this,
that item will be skipped. If it turns out that incorrect limits have been set
on some feature, please let me know!

## Via TPM (recommended)

The easiest way to install `tmux-menus` is via the [Tmux Plugin
Manager](https://github.com/tmux-plugins/tpm).

1. Add plugin to the list of TPM plugins in `.tmux.conf`:

   ```tmux
   set -g @plugin 'jaclu/tmux-menus'
   ```

2. Hit `<prefix> + I` to install the plugin and activate it. The plugin should now
   be usable.

## Manual Installation

1. Clone the repository

   ```sh
   git clone https://github.com/jaclu/tmux-menus ~/clone/path
   ```

2. Add this line to the bottom of `.tmux.conf`

   ```tmux
   run-shell ~/clone/path/menus.tmux
   ```

3. Reload the `tmux` environment

   ```sh
   # type this inside tmux
   $ tmux source-file ~/.tmux.conf
   ```

The plugin should now be activated.

## Configuration

### Boolean parameters

All boolean parameters accept the following values:

- `Yes` `True` `1`
- `No` `False` `0`

This is case-insensitive, meaning any combination of uppercase and lowercase
letters is accepted.

### Display menus

The default trigger is `<prefix> \` The trigger is configured like this:

```tmux
set -g @menus_trigger 'Space'
```

See [SingleQuotes](docs/SingleQuotes.md) for how to handle special chars like `\`
in tmux variables.

### Display without using prefix

```tmux
set -g @menus_without_prefix 'Yes'
```

This boolean parameter defaults to `No`

Use this in order to trigger menus without first hitting `<prefix>`

### Pointer to the config file

```tmux
set -g @menus_config_file "~/.configs/tmux.conf"
```

See [SingleQuotes](docs/SingleQuotes.md) for how to handle `$HOME` and `~`
in tmux variables.

In the main menu, the tmux config file to be reloaded.
The default location for this is:

1. `@menus_config_file` - if this is defined in the tmux config file, it will be used.
2. `$TMUX_CONF` - if this is present in the environment, it will be used.
3. `$XDG_CONFIG_HOME/tmux/tmux.conf` - if `$XDG_CONFIG_HOME` is defined.
4. `~/.tmux.conf` - Default if none of the above are set.

When a reload is requested, the conf file will be prompted for, defaulting
to the first match above. It can be manually changed.

### Menu location

The default locations are: `C` for tmux >= 3.2 `P` otherwise. If whiptail/dialog
is used, menu location is ignored

```tmux
set -g @menus_location_x 'W'
set -g @menus_location_y 'S'
```

For all location options see the tmux man page, search for `display-menu`.
The basic options are:

| Value | Flag | Meaning                                        |
| ----- | ---- | ---------------------------------------------- |
| C     | Both | The centre of the terminal (tmux 3.2 or newer) |
| R     | -x   | The right side of the terminal                 |
| P     | Both | The bottom left of the pane                    |
| M     | Both | The mouse position                             |
| W     | Both | The window position on the status line         |
| S     | -y   | The line above or below the status line        |

### Disable caching

```tmux
set -g @menus_use_cache 'No'
```

This boolean parameter defaults to `Yes`

By default menu items are cached.

Disabling caching also disables the Custom Menus feature.

To be more precise, items listed inside `static_content()` are cached.
Some items need to be freshly generated each time a menu is displayed,
those items are defines in `dynamic_content()` see
[scripts/pane_move.sh](items/pane_move.sh) for an example of this. In that case,
"Swap current pane with marked" is only displayed if there is a marked pane.

The plugin remembers what tmux version was used last time.
If another version is detected as the plugin is initialized, the entire
cache is dropped, so that the right version dependent items can be
selected as the cache is re-populated.
Same if a menu script is changed, if the script is newer than the cache,
that cache item is regenerated.

### Use Hint Overlays

```tmux
set -g @menus_use_hint_overlays 'No'
```

This boolean parameter defaults to `Yes`

This feature is not available when whiptail / dialog is used.

Some menu items will display tmux dialogs, where each have their own rather complex
set of special key bindings - choose-buffer, choose-client, choose-tree and
customize-mode

When entering such a dialog, per default an overlay will first be presented lisitng
the keys available for that dialog, if it fits on screen.

Use this setting to disable the overlay feature.

If `@menus_use_hint_overlays` is enabled, there is a support option
`@menus_show_key_hints` (defaults to 'No') that also can be toggled.
If `@menus_use_hint_overlays` is disabled, `@menus_show_key_hints` is ignored.

#### Show Key Hints

```tmux
set -g @menus_show_key_hints 'Yes'
```

This boolean parameter defaults to `No`

Related to `@menus_use_hint_overlays` Since those key-listings tend to be rather long
they might not fit on screen, and thus be silently skipped.
Enabling this will offer an extra option `Key Hints` on each menu featuring an
alternative that will display such a dialog, and mentioning which item on that
menu it is related to.

This Key Hint will display the dialog the normal way, giving a warning if the
screen is to small, mentioning required screen size.

It will also serve as a hint as to what menu entries are expected to display an overlay.

### Logging

Per default logging is disabled. If this is desired, provide a log file name
like this:

```tmux
set -g @menus_log_file "~/tmp/tmux-menus.log"
```

See [SingleQuotes](docs/SingleQuotes.md) for how to handle `$HOME` and `~`
in tmux variables.

### Display menu commands

```tmux
set -g @menus_display_commands 'Yes'
```

This boolean parameter defaults to `No`

This feature is not available when whiptail / dialog is used or caching is disabled.

If set to true each menu will include an extra item `Display Commands` with the
shortcut `!`

Pressing this will display what commands are used for each action.

Pressing this again will display all matching prefix and root binds.
If multiple key binds matches, all of them will be listed.

Be aware that the menu will be taller when using this, so make sure the screen is
large enough to handle it!

If this is defined, there is a support setting that can be used:

```tmux
set -g @menus_display_cmds_cols 160
```

This is the maximum line length that will be used to display commands.
It defaults to `75` but can be changed if the display is really wide or narrow.

If the displayed command doesn't fit on one line, it will be split in chunks, if
possible it will be split on the last white space before `@menus_display_cmds_cols`
length. If no white space is found, the cmd will be split at the indicated max length.

In case this is set too wide, and the line doesn't fit on the display, tmux will
cut the line ending it with `>`.

Such lines are truncated. And the entire command was not displayed.

If commands end with `>` it is recommended to use a narrower setting for
`@menus_display_cmds_cols`

### Alternate menus

```tmux
set -g @menus_main_menu "~/my_tmux_menus/main.sh"
```

This option has no default. If unset, the built-in menus are used.
It can be set to override the default menus with a custom set.

Note: If a custom menu links to any of the built-in menus, the “main menu” in those
remains the default one.
There is no built-in mechanism to return to the custom main menu from there.
You’ll need to close the menu and trigger your custom main menu again.

Also, all custom menus must define D_TM_BASE_PATH to point to the tmux-menus
installation directory. This is required for support scripts to be located correctly.

## Custom Menus

While the initial assumption was that users wanting to modify the menus would fork
the repository and make changes directly, a feature was added to allow menus to
be added dynamically based on user requests.

The primary difference between alternate and custom menus is that custom menus
integrate into the official menus, and alternate menus are completely separate.

For details on how to use this feature, see the documentation:
[docs/CustomMenus.md](docs/CustomMenus.md)

## Screen might be too small

tmux does not give any error if a menu doesn't fit the available screen,
it just does not display the menu.

The only hint is that the menu is terminated instantaneously.

Since this test is far from perfect, and some computers are really slow,
the current assumption is that if it was displayed < 0.1 seconds,
it was likely due to screen size.
On really slow systems, the cut-off is 0.5 seconds, since they would typically
need > 0.1 just to process the menu.
In that case this error will be displayed on the status-bar:

```tmux
tmux-menus ERROR: Screen might be too small
```

It will also be displayed if the menu is closed right away intentionally
or unintentionally, so there will no doubt sometimes be false positives.
If it doesn't happen the next time the menu is attempted, it can be ignored.

## whiptail / dialog - alternate tools for displaying menus

For tmux < 3.0 the tmux feature`display-menu` is not available.

If found `whiptail` or `dialog` will be used to display menus.

The preferred option is whiptail, but if not found dialog will be used instead.
If neither is available, this plugin will abort displaying an error message.

Since these are full-screen apps, when either is used, the current (if any)
task is suspended, dialogs are run, and when done the suspended task is reactivated.

The menu system works the same using external menu handlers, however the menu
shortcuts are not as convenient, since they do not differentiate between upper
and lower case letters,
and does not at all support special keys like 'Left' or 'Home'

To use external dialog handling on modern tmuxes set this env variable:

- for `whiptail` use `export TMUX_MENUS_HANDLER=1`
- for `dialog` use `export TMUX_MENUS_HANDLER=2`

In most cases whiptail is installed by default on Linux distros. If not, install
it using the package manager.
One gotcha is that in the Red Hat universe the package is not called whiptail,
the package containing whiptail is called `newt`.

MacOS does not come with whiptail, but it is available in the Homebrew package `newt`.

## Contributions

Contributions are welcome, and they're appreciated.
Every little bit helps, and credit is always given.

The best way to send feedback is to file an
[issue](https://github.com/jaclu/tmux-menus/issues)

## Thanks to

- [cmon1701](https://github.com/cmon1701) For notifying me that the plugin listing
  used hardcoded path assumptions - Addressed in release 2.1.3
- [sumskyi](https://github.com/sumskyi) for notifying me that the boolean check
  error message for invalid values lacked the significant info about what variable
  contained the incorrect value. Addressed in release 2.0.2
- [GaikwadPratik](https://github.com/GaikwadPratik) for notifying me that the
  Disable caching feature was broken
- [Tony Soloveyv](https://github.com/tony-sol) for spotting an unintentional
  shortcut change in the main menu
- [JuanGarcia345](https://github.com/JuanGarcia345) for suggesting to make
  menu-cache optional.
- [phdoerfler](https://github.com/phdoerfler) for noticing TMUX_BIN was often not set,
  I had it defined in my .tmux.conf, so totally missed such errors, in future testing I
  will make sure not to rely on env variables.
- [giddie](https://github.com/giddie) for suggesting "Re-spawn current pane"
- [wilddog64](https://github.com/wilddog64) for suggesting adding a prefix
  to the curl that probes public IP

## License

[MIT](LICENSE)
